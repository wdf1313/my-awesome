# 浏览器中的事件循环 Event Loop

事件循环 Event Loop 是 JavaScript 执行机制的核心。由于 JavaScript 是单线程的，为了**实现异步操作**（如定时器、网络请求、DOM 事件等）。浏览器采用事件循环机制协调同步任务和异步任务的**执行顺序**。

## 执行栈、任务队列、Web 线程

**执行栈（Call Stack）**

执行栈是 JavaScript 代码执行的**主线程**，所有同步任务都会被压入执行栈，逐条执行，执行完毕后出栈。

**任务队列 （Task Queue）**

任务队列用于存放异步任务的回调函数，根据任务不同，任务队列分为两类：

- 宏任务（Macro task）：如 `setTimeout`、`setInterval`、`I/O`、`UI渲染`、`<script>` 等
- 微任务（Micro Task）：如 `Promise.then`、`MutationObserver`、`queueMicrotask` 等

**Web API 线程**：计时器线程、网络线程、事件线程、渲染线程等。

## 事件循环的执行过程

1. 执行栈中同步代码自上而下执行；
2. 遇到异步任务（如定时器、Promise、fetch），将其**挂起交给对应的浏览器线程**处理（比如定时器线程、网络线程）
3. 处理完成后，浏览器会把**回调函数**送入**相应的任务队列（宏任务队列 or 微任务队列）**；
4. 执行栈清空后，进入**事件循环**：
   - 先检查微任务队列，依次执行所有微任务，直到队列清空；
   - 再从宏任务队列中取出一个任务，放入执行栈执行；
   - 重复上述过程；
